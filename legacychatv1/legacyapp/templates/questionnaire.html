<!DOCTYPE html>
<html>
<head>
  <title>Questionnaire</title>
  <style>
    .question {
      display: none;
    }

    /* Reset some default styles to provide a consistent baseline */
    html, body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        line-height: 1.6;
        background-color: #f5f5f5;
    }

    /* Center the content on the page */
    .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 30px;
        background-color: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* Style headings */
    h1, h2, h3 {
        color: #333;
    }

    /* Style links */
    a {
        color: #007bff;
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }

    /* Style buttons */
    button {
        display: inline-block;
        padding: 8px 16px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    button:hover {
        background-color: #0056b3;
    }

    /* Add spacing between elements */
    p, ul, ol {
        margin-bottom: 15px;
    }

    /* Style images */
    img {
        max-width: 100%;
        height: auto;
    }

    /* Style textareas */
    textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        resize: vertical; /* Allow vertical resizing */
        font-family: "Times New Roman", Times, serif; /* Set a specific font */
    }

    /* Style inputs */
    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical; /* Allow vertical resizing */
      font-family: "Times New Roman", Times, serif; /* Set a specific font */
    }

    body {font-size: x-large}
  </style>
</head>
<body>
<div class="container">

  <h1>{{chapter_name}}</h1>
  <hr>
  <form action="" method="POST">{% csrf_token %}

    <!-- FOR loop that creates each question -->
    {% for question in data %}
    <div class="question" id="quest{{question.question_idx}}">
      <h2>Question {{question.question_idx}}</h2>
      <label for="question{{question.question_idx}}">{{question.question}}</label><br>
      <textarea id="question{{question.question_idx}}" name="question{{question.question_idx}}" rows="20" cols="133">{{question.previous_answer}}</textarea>
    </div>
    {% endfor %}
    <br>
    <div>

      <button type="button" onclick="showPreviousQuestion()">Previous</button>
      <button type="button" onclick="showNextQuestion()">Next</button>
      <button type="button" onclick="saveAnswers()">Save</button>

      <br><br>

      <label for="gotoQuestion">Go to question:</label>
      <input type="number" id="gotoQuestion" style="width: 40px;" min="1" max="20">
      <button type="button" onclick="goToQuestion()">Go</button>

    </div>
    <br>
    <input type="hidden" name="chapter" value="{{chapter}}">
    <button formaction="../../fireapp/save-answers/" name="exit" value="false">Save and exit!</button>
  </form>

</div>

<script>
  var currentQuestion = 1;
  var totalQuestions = document.getElementsByClassName('question').length;

  function showQuestion(questionNumber) {
    var questions = document.getElementsByClassName('question');
    for (var i = 0; i < questions.length; i++) {
      questions[i].style.display = 'none';
    }
    document.getElementById('quest' + questionNumber).style.display = 'block';
  }

  function showNextQuestion() {
    if (currentQuestion < totalQuestions) {
      currentQuestion++;
      showQuestion(currentQuestion);
    }
  }

  function showPreviousQuestion() {
    if (currentQuestion > 1) {
      currentQuestion--;
      showQuestion(currentQuestion);
    }
  }

  function goToQuestion() {
    var questionNumberInput = document.getElementById('gotoQuestion');
    var questionNumber = parseInt(questionNumberInput.value);

    if (questionNumber >= 1 && questionNumber <= totalQuestions) {
      currentQuestion = questionNumber;
      showQuestion(currentQuestion);
    }


    questionNumberInput.value = '';
  }

  function saveAnswers() {
    var form = document.querySelector('form');
    var formData = new FormData(form);

    var xhr = new XMLHttpRequest();
    xhr.open("POST", "../../fireapp/save-answers/", true);

    xhr.onreadystatechange = function () {
      if (xhr.readyState === XMLHttpRequest.DONE) {
        if (xhr.status === 200) {
          // Successful response
          console.log(xhr.responseText);
        } else {
          // Error handling
          console.error("Error: " + xhr.status);
        }
      }
    };

    xhr.send(formData);
  }

  showQuestion(currentQuestion);

</script>

</body>
</html>
